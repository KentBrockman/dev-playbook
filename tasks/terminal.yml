---
- name: install terminal related packages
  become: true
  apt:
    pkg:
      # better shell and helper methods
      - zsh
      - zsh-autosuggestions
      # terminal multiplexer
      - tmux
      # cli text editor
      - vim
      # use clipboard from terminal
      - xclip
      # great fuzzy finder utility
      - fzf
      # nice grep replacement
      - ripgrep
      # cat/less upgrade with syntax highlighting
      - bat
      # JSON formatter
      - jq
      # show example usage of commands
      - tldr
      # nicer ping too
      - prettyping
# TODO: some environment variables should be set for tool configurations above
# right now I'm storing these in ~/.profile
# but they should be condition (i.e. if the right tools arent installed, dont set them)
# Listing below:
# use ripgrep to find files before passing them to fzf (default is find, which doesnt respect .gitignore)
# export FZF_DEFAULT_COMMAND="rg --files ."
# not as related here, but pyenv init is another one

- name: Install oh-my-zsh
  git:
    repo: https://github.com/robbyrussell/oh-my-zsh.git
    dest: ~/.oh-my-zsh

- name: confirm preferred shell executable is installed
  stat:
    path: "{{ preferred_shell }}"
  register: preferred_shell_executable

- name: set preferred shell for user
  become: true
  user:
    name: "{{ ansible_user_id }}"
    shell: "{{ preferred_shell }}"
  when: preferred_shell_executable.stat.exists

- name: ensure local font directory exists
  file:
    name: ~/.local/share/fonts
    state: directory

- name: install custom fonts
  block:
    - name: get all custom fonts
      command: "ls {{ font_src_dir }}"
      register: fonts
      changed_when: False

    - name: install custom fonts
      copy:
        src: "{{ font_src_dir }}/{{ item }}"
        dest: "~/.local/share/fonts/{{ item }}"
      with_items: "{{ fonts.stdout_lines }}"
  vars:
    font_src_dir: "files/fonts"
  tags: ['fonts']
